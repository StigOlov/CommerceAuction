{% extends "auctions/layout.html" %}

{% block body %}

    <h1>{{ listing.item_name }}</h1>
    <p>Item Price: ${{ listing.item_price}}</p>
    <p> Current highest bidder: {{ highest_bidder_username }}</p>
    <p>Starting Bid: ${{ listing.starting_bid}}</p>
    <p>Closing Date: {{ listing.closing_date}}</p>
    <p> Category: {{ listing.category }}</p>
    <p>Description: {{ listing.description}}</p>
    {% if listing.image %}
    <img src="{{ listing.image.url }}" alt="Listing Image" width="300">
    {% endif %}

    {% if messages %}
        <ul class="messages">
        {% for message in messages %}
            <li{% if message.tags %} class="{{ message.tags}}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}
        </ul>

    <div>
    <h3> Add To Watchlist </h3>
        <form method="post" action="{% url 'add_to_watchlist' listing_id=listing.id %}">
            {% csrf_token %}
            <button type="submit">Add To Watchlist</button>
        </form>
    </div>

    <div> 
    <h3>Place Bid</h3>
        <form method="post" action="{% url 'place_bid' listing_id=listing.id %}">
            {% csrf_token %}
            <label for="bid_amount">Bid Amount:</label>
            <input type="number" step="0.01" name="bid_amount" required>
            <button type="submit">Place bid</button>
        </form>
    </div>

    <h3>Add comment</h3>
    <form method="post" action="{% url 'place_comment' listing_id=listing.id%}">
        {% csrf_token %}
        <label for="comment_text">Your Comment:</label>
        <textarea name="comment_text"required></textarea>
        <button type="submit">Add Comment</button>
    </form>

    <h3>Comments</h3>
    <ul>
        {% for comment in comments %}
        <li> {{ comment.user_id.username }}: {{comment.content}} {{comment.timestamp}}</li>
        {% empty %}
        <li> No comments yet. </li>
        {% endfor %}
    </ul>
    <a href="{% url 'my_listings' %}">My listings</a>
    <a href="{% url 'display_watchlist' %}">My Watchlist</a>

{% endblock %}